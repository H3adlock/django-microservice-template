FROM node:10.2-alpine

# Python support added based on:
#https://github.com/frol/docker-alpine-python3/blob/master/Dockerfile

# These are always installed. Notes:
#   * dumb-init: a proper init system for containers, to reap zombie children
#   * bash: For entrypoint, and debugging
#   * ca-certificates: for SSL verification during Pip and easy_install
#   * python: the binaries themselves

RUN apk update && \
    apk add --no-cache python3 && \
    python3 -m ensurepip && \
    rm -r /usr/lib/python*/ensurepip && \
    pip3 install --upgrade pip setuptools && \
    if [ ! -e /usr/bin/pip ]; then ln -s pip3 /usr/bin/pip ; fi && \
    if [[ ! -e /usr/bin/python ]]; then ln -sf /usr/bin/python3 /usr/bin/python; fi && \
  rm -r /root/.cache

RUN apk update && \
    apk add --no-cache \
    dumb-init \
    bash \
    ca-certificates \
    python3 \
    chromium \
    chromium-chromedriver \
    less \
    vim \
    curl

  # make some useful symlinks that are expected to exist
  RUN if [[ ! -e /usr/bin/python ]];        then ln -sf /usr/bin/python3 /usr/bin/python; fi \
  && if [[ ! -e /usr/bin/python-config ]]; then ln -sf /usr/bin/python-config3 /usr/bin/python-config; fi \
  && if [[ ! -e /usr/bin/idle ]];          then ln -sf /usr/bin/idle3 /usr/bin/idle; fi \
  && if [[ ! -e /usr/bin/pydoc ]];         then ln -sf /usr/bin/pydoc3 /usr/bin/pydoc; fi \
  && if [[ ! -e /usr/bin/easy_install ]];  then ln -sf $(ls /usr/bin/easy_install*) /usr/bin/easy_install; fi \
  && echo

ENV DIRPATH /opt/{{ project_name }}
LABEL "application"="{{ project_name }}-testing"
RUN mkdir -p $DIRPATH/{{ project_name }}-testing

WORKDIR $DIRPATH/{{ project_name }}-testing
COPY . .

RUN pip install -U pip \
  && pip install -r requirements.txt