.. {{ project_name }} documentation master file, created by
   sphinx-quickstart on Tue Dec 29 19:06:20 2015.
   You can adapt this file completely to your liking, but it should at least
   contain the root `toctree` directive.

For developers
=========================================

Installation
************

Below is description how to use it in local development. On staging environment and production.

Local development
----------------- 

All what you need is to have `Docker Engine <https://docs.docker.com/>`_ and `Docker Compose <https://docs.docker.com/>`_   installed on your OS.
Current version of {{ project_name }} (1.0.1) was tested with Docker Engine 1.10.1 and Docker Compose 1.8

To build base image for django applications (this will take a while)::

    make build-base

To build all needed containers and make them up and running::

    build run

* `Admin page <http://127.0.0.1/admin/>`_ 
* `Documentation <http://127.0.0.1/docs/>`_


Staging / integration environment
---------------------------------

TODO


Production
----------

TODO

Developing changes
******************

When all docker containers are up and running, what can be checked by runing::

	docker ps

You should see containers with names::
  
  {{ project_name }}-db
  {{ project_name }}-web
  {{ project_name }}-nginx
  {{ project_name }}-testing

To stop all containers::

  docker-compose down

Changes in web are dynamically reloading
to reload nginx container run::

   docker-compose build nginx
   docker-compose up --no-deps -d nginx

to recreate base container run::

   docker-compose down
   make rmi-base
   make build-base

to reload changes in docs run::

   cd docs
   make html

Shortcuts
*********

If you are lasy (like we are) you can take look into Makefile and use some shortcuts like::

  make clean

to stop and remove all containers and images build by docker-compose.
To remove image for {{ project_name }}/base as well (base image for django app container) run ::

  make rmi-base

If you just run ::

  make

it will build and start all you need to have working {{ project_name }}.

Troubleshooting
***************

When you will notice any network related problems (like being unable to reach internet during images building or from a built container; very slow network response within containers' network), check if in file on host machine::

  /etc/default/docker

You have uncommented::

  DOCKER_OPTS="--dns 8.8.8.8 --dns 8.8.4.4"

After that don't forget to restart docker-engine servie. For Ubuntu::

  sudo service docker restart


Testing
*******

BDD / SBE
---------

BDD is done with `behave <http://pythonhosted.org/behave/>`_. Steps should use only exposed REST API to make it technology agnostic.

To run SBE tests ::

    make sbe


Production
**********

to run on production use command::

    make run-prod

Documentation
*************

Generated by `Sphinx <http://sphinx-doc.org/>`_ with useg of `reStructuredText <http://docutils.sourceforge.net/docs/user/rst/quickref.html>`_.

To be able to change and build new version of documentation you need to have python modules from ./docs/requirements.txt installed. 
An easy way to do it is to use `Virtualenv <https://virtualenv.pypa.io/en/latest/>`_ ::

  cd docs
  virtualenv -p /usr/bin/python3 virtenv
  source ./virtenv/bin/activate
  pip3 install -r requirements.txt

If everything went well you should be able to successfully compile documentation into html::

  make html


.. toctree::
   :maxdepth: 2



